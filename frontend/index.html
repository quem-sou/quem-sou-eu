<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<title>Quem Sou Eu</title>

<style>
body {
margin: 0;
font-family: Arial, sans-serif;
background: url("assets/images/background.jpg") no-repeat center center fixed;
background-size: cover;
color: white;
}

#container {
width: 420px;
margin: 80px auto;
background: rgba(0,0,0,0.75);
padding: 20px;
border-radius: 12px;
}

h1 {
text-align: center;
}

select, input, button {
width: 100%;
padding: 10px;
margin-top: 10px;
font-size: 16px;
}

button {
background: gold;
border: none;
cursor: pointer;
font-weight: bold;
}

button:hover {
opacity: 0.9;
}

#chat {
height: 220px;
overflow-y: auto;
margin-top: 10px;
}

.user {
text-align: right;
color: #4fc3f7;
}

.bot {
text-align: left;
}

#top-bar {
display: flex;
justify-content: space-between;
align-items: center;
}

#audioBtn {
cursor: pointer;
font-size: 22px;
}
</style>
</head>

<body>

<audio id="bgAudio" loop></audio>

<div id="container">

<div id="top-bar">
<h1>QUEM SOU EU</h1>
<div id="audioBtn">üîá</div>
</div>

<div id="menu">
<select id="category">
<option value="">Escolhe a categoria</option>
<option value="cinema">Cinema & TV</option>
<option value="desporto">Desporto</option>
<option value="historia">Hist√≥ria</option>
<option value="musica">M√∫sica</option>
</select>

<select id="difficulty">
<option value="">Escolhe a dificuldade</option>
<option value="iniciante">Iniciante</option>
<option value="experiente">Experiente</option>
<option value="genio">G√©nio</option>
</select>

<button onclick="startGame()">Come√ßar Jogo</button>
</div>

<div id="game" style="display:none;">
<p><b>Tentativas:</b> <span id="tries">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></p>
<div id="chat"></div>
<input id="question" placeholder="Escreve a tua pergunta..." />
<button onclick="sendQuestion()">Enviar</button>
<button onclick="guess()">Adivinhar Personagem</button>
<button onclick="backMenu()">‚Üê Voltar</button>
</div>

</div>

<script>
const audio = document.getElementById("bgAudio");
const audioBtn = document.getElementById("audioBtn");

let audioOn = false;
let attempts = 3;
let currentCategory = null;

/* ================= AUDIO ================= */

function setAudio(src, autoplay=false) {
audio.pause();
audio.src = src;
audio.load();
if (autoplay) {
audio.play();
audioOn = true;
audioBtn.textContent = "üîä";
} else {
audioOn = false;
audioBtn.textContent = "üîá";
}
}

audioBtn.onclick = () => {
if (!audio.src) return;
if (audioOn) {
audio.pause();
audioBtn.textContent = "üîá";
} else {
audio.play();
audioBtn.textContent = "üîä";
}
audioOn = !audioOn;
};

/* ================= MENU ================= */

setAudio("assets/audio/menu.mp3", false);

async function startGame() {
const category = document.getElementById("category").value;
const difficulty = document.getElementById("difficulty").value;

if (!category || !difficulty) {
alert("Escolhe categoria e dificuldade");
return;
}

currentCategory = category;

await fetch("http://localhost:3000/start", {
method: "POST",
headers: {"Content-Type": "application/json"},
body: JSON.stringify({ category, difficulty })
});

document.getElementById("menu").style.display = "none";
document.getElementById("game").style.display = "block";

attempts = 3;
document.getElementById("tries").textContent = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è";
document.getElementById("chat").innerHTML =
`<div class="bot">Ol√°! Quem achas que sou?</div>`;

setAudio(`assets/audio/${category}.mp3`, true);
}

/* ================= GAME ================= */

async function sendQuestion() {
const input = document.getElementById("question");
if (!input.value) return;

addChat("user", input.value);

const res = await fetch("http://localhost:3000/ask", {
method: "POST",
headers: {"Content-Type": "application/json"},
body: JSON.stringify({ question: input.value })
});

const data = await res.json();
addChat("bot", data.answer);
input.value = "";
}

function addChat(who, text) {
const chat = document.getElementById("chat");
const div = document.createElement("div");
div.className = who;
div.textContent = text;
chat.appendChild(div);
chat.scrollTop = chat.scrollHeight;
}

async function guess() {
const name = prompt("Qual √© o nome da personagem?");
if (!name) return;

const res = await fetch("http://localhost:3000/guess", {
method: "POST",
headers: {"Content-Type": "application/json"},
body: JSON.stringify({ name })
});

const data = await res.json();
addChat("bot", data.result);

if (!data.correct) {
attempts--;
document.getElementById("tries").textContent = "‚ù§Ô∏è".repeat(attempts);
}

if (data.gameOver || data.correct) {
audio.pause();
audioBtn.textContent = "üîá";
}
}

/* ================= BACK ================= */

function backMenu() {
audio.pause();
setAudio("assets/audio/menu.mp3", false);
document.getElementById("game").style.display = "none";
document.getElementById("menu").style.display = "block";
}
</script>

</body>
</html>
